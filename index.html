<!DOCTYPE html>
<html>
    <head></head>
    <body>

        <div style="width:75%;">
            <canvas id="canvas"></canvas>
        </div>
        
        <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
        <script
			  src="https://code.jquery.com/jquery-3.5.1.min.js"
			  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
			  crossorigin="anonymous"></script>
        <script>
            $(function () {
                function getCommits(date, callback) {
                    var items = {
                        0: 0, 1: 0, 2: 0, 3: 0, 
                        4: 0, 5: 0, 6: 0, 7: 0, 
                        8: 0, 9: 0, 10: 0, 11: 0,
                        12: 0, 13: 0, 14: 0, 15: 0,
                        16: 0, 17: 0, 18: 0, 19: 0,
                        20: 0, 21: 0, 22: 0, 23: 0,
                        
                    };
                    for(var i = 0; i < 10; i++) {
                        $.ajax(
                            'https://api.github.com/search/commits?q=author:{USER}&per_page=100&order=desc&sort=committer-date',
                            {
                                headers: {
                                    'Accept': 'application/vnd.github.cloak-preview',
                                    'Authorization': 'token {TOKEN}',
                                },
                                method: 'GET'
                            })
                            .done(function(data, status, request) {
                                for (item in data.items) {
                                    var date = new Date(data.items[item].commit.author.date);
                                    
                                    if (items[date.getHours()] == undefined) {
                                        items[date.getHours()] = 0;
                                    }

                                    items[date.getHours()] += 1;
                                }

                                callback(items);
                            }
                        );
                    }
                }

                var config = {
                    type: 'line',
                    data: {
                        labels: [
                            '00h', '01h', '02h', '03h', '04h', '05h', '06h', '07h', '08h', '09h', '10h', '11h',
                            '12h', '13h', '14h', '15h', '16h', '17h', '18h', '19h', '20h', '21h', '22h', '23h',
                        ],
                        datasets: [{
                            label: 'Productivity',
                            backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgb(255, 99, 132)',
                            data: [],
                            fill: false,
                        }],
                    },
                    options: {
                        responsive: true,
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Hours'
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Commits'
                                }
                            }]
                        }
                    }
                };

                getCommits('2020-04-22', function (commits) {
                    config.data.datasets.forEach(function(dataset) {
                        console.log(commits);
                        dataset.data = Object.values(commits);
                    });

			        window.myLine.update();
                });

                var ctx = document.getElementById('canvas').getContext('2d');
                window.myLine = new Chart(ctx, config);
            });
        </script>
    </body>
</html>
